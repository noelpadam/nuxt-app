[build]
  # ✅ Simplification: The "bun --bun run" is generally only needed for
  # the 'dev' command. For 'build', simply running 'bun run nuxt build' 
  # is sufficient when NETLIFY_USE_BUN is true.
  command = "bun install --frozen-lockfile && bun --bun run nuxt build"
  
  # default Nuxt 3/4 Nitro output, as 'dist' is often incorrect.
  publish = "dist" 

# Configuration for the serverless function handler
[functions]
  # ✅ Correct: This targets the directory where the Nuxt Netlify adapter 
  # places the final serverless function handler.
  directory = ".netlify/functions-internal"
  # Removed: node_bundler = "esbuild" - Not usually needed with Nuxt/Nitro preset.

[build.environment]
  NETLIFY_USE_BUN = "true"
  NPM_FLAGS = "--ignore-scripts"
  # 5. RECOMMENDED: Pins the Bun version for stable, consistent builds.
  # Replace 1.3.3 with the specific version you develop with locally.
  BUN_VERSION = "1.3.3"
  # Force Node.js version 20 or 22 (LTS is recommended)
  NODE_VERSION = "22"